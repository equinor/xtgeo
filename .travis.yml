language: python

if: branch=master

env:
  global:
    - REPO_DIR=.
    - UNICODE_WIDTH=32
    - PLAT=x86_64
    - MB_PYTHON_VERSION=$TRAVIS_PYTHON_VERSION
    - VERSION=$(echo $TRAVIS_TAG | sed s/v//)
    - BUILD_DEPENDS="cmake numpy"
    - CONFIG_PATH=scripts/config.sh
    - TEST_DEPENDS="pytest"

addons:
  apt:
    packages:
    - swig

python:
#  - '2.7'
  - '3.6'

before_script:
  - git clone https://git@github.com/equinor/xtgeo-testdata.git ../xtgeo-testdata

script:
  - make develop

jobs:
  include:
    - &xtgeo-wheels
      stage: wheels
      if: branch=master
      os:
        - linux
      env:
        - MB_PYTHON_VERSION=3.6

      services: docker
      sudo: required
      before_install:
        - echo "Repo is $REPO_DIR"
        - echo "PWD is $PWD"
        - source multibuild/common_utils.sh
        - source multibuild/travis_steps.sh
        - before_install
      install:
        - build_wheel $REPO_DIR $PLAT
      script:
        - install_run $PLAT
      after_success:
        - ls -l ${TRAVIS_BUILD_DIR}/wheelhouse
      # deploy:
      #   provider: script
      #   script:
      #     - ls -latr
      #     - echo "DEPLOY"


    # - <<: *xtgeo-wheels
    #   env:
    #     - MB_PYTHON_VERSION=3.5
    # - <<: *xtgeo-wheels
    #   env:
    #     - MB_PYTHON_VERSION=3.7
    # - <<: *xtgeo-wheels
    #   env:
    #     - MB_PYTHON_VERSION=2.7


deploy:
  provider: script
  script: bash scripts/deploy.sh

#   provider: pypi
#   user: 2m
#   server: https://testpypi.python.org/pypi # Remove for deployment to official PyPi repo
#   password:
#     secure: ...
#   on:
#     tags: true
#     repo: 2m/test-pypi-deploy
