language: python

env:
  global:
    - REPO_DIR=xtgeo
    - UNICODE_WIDTH=32
    - PLAT=x86_64
    - MB_PYTHON_VERSION=$TRAVIS_PYTHON_VERSION
    - VERSION=$(echo $TRAVIS_TAG | sed s/v//)
    - BUILD_DEPENDS="cmake numpy"
    - CONFIG_PATH=scripts/config.sh
    - TEST_DEPENDS="pytest"

addons:
  apt:
    packages:
    - swig

python:
  - '2.7'
  - '3.6'

before_script:
  - git clone https://git@github.com/equinor/xtgeo-testdata.git ../xtgeo-testdata

script:
  - make develop
  - pytest tests/test_simple

jobs:
  include:
    - &xtgeo-wheels
      stage: wheels
      os:
        - linux
      env:
        - MB_PYTHON_VERSION=3.6

      services: docker
      sudo: required
      before_install:
        - echo "Repo is $REPO_DIR"
        - echo "PWD is $PWD"
        - source multibuild/common_utils.sh
        - source multibuild/travis_steps.sh
        - before_install
      install:
        - build_wheel $REPO_DIR $PLAT
      script:
        - install_run $PLAT
      after_success:
        - ls -l ${TRAVIS_BUILD_DIR}/wheelhouse
    - <<: *xtgeo-wheels
      env:
        - MB_PYTHON_VERSION=3.5
